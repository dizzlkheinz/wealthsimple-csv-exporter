javascript:(function()%7Bjavascript%3A(function()%7B%0A%20%20%20%20%2F*%20%0A%20%20%20%20%20*%20Wealthsimple%20Transaction%20Export%20Bookmarklet%0A%20%20%20%20%20*%20Features%3A%0A%20%20%20%20%20*%20-%20Exports%20to%20CSV%20(Date%2C%20Payee%2C%20Amount)%0A%20%20%20%20%20*%20-%20Formats%20Date%20as%20YYYY-MM-DD%20(compatible%20with%20YNAB%2FExcel)%0A%20%20%20%20%20*%20-%20Skips%20%22Pending%22%20transactions%0A%20%20%20%20%20*%20-%20Handles%20%22Today%22%2F%22Yesterday%22%20and%20standard%20dates%0A%20%20%20%20%20*%20-%20clean%20parsing%20of%20currency%20(handles%20negative%20symbols%20like%20%C3%A2%E2%88%92)%0A%20%20%20%20%20*%2F%0A%0A%20%20%20%20function%20cleanAmount(str)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20Remove%20currency%20symbols%2C%20spaces%2C%20and%20normalize%20negative%20signs%0A%20%20%20%20%20%20%20%20return%20parseFloat(str.replace(%2F%5B%C3%A2%E2%88%92%C3%A2%E2%80%93%C3%A2%E2%80%94%E2%88%92%5D%2Fg%2C%20'-').replace(%2F%5B%5E%5Cd.-%5D%2Fg%2C%20''))%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20formatDate(dateStr)%20%7B%0A%20%20%20%20%20%20%20%20const%20today%20%3D%20new%20Date()%3B%0A%20%20%20%20%20%20%20%20let%20date%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20if%20(dateStr%20%3D%3D%3D%20%22Today%22)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20date%20%3D%20today%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(dateStr%20%3D%3D%3D%20%22Yesterday%22)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20date%20%3D%20new%20Date(today)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20date.setDate(today.getDate()%20-%201)%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20date%20%3D%20new%20Date(dateStr)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20If%20the%20date%20string%20doesn't%20have%20a%20year%20(e.g.%20%22May%2012%22)%2C%20assume%20current%20year%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!%2F%5Cd%7B4%7D%2F.test(dateStr))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20date.setFullYear(today.getFullYear())%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20Return%20YYYY-MM-DD%20format%0A%20%20%20%20%20%20%20%20const%20year%20%3D%20date.getFullYear()%3B%0A%20%20%20%20%20%20%20%20const%20month%20%3D%20(date.getMonth()%20%2B%201).toString().padStart(2%2C%20'0')%3B%0A%20%20%20%20%20%20%20%20const%20day%20%3D%20date.getDate().toString().padStart(2%2C%20'0')%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20return%20%60%24%7Byear%7D-%24%7Bmonth%7D-%24%7Bday%7D%60%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20const%20rows%20%3D%20%5B%5D%3B%0A%20%20%20%20const%20seen%20%3D%20new%20Set()%3B%20%2F%2F%20To%20prevent%20duplicates%0A%0A%20%20%20%20%2F%2F%20Step%201%3A%20Find%20all%20Date%20Headers%20(H2%20tags)%0A%20%20%20%20const%20headers%20%3D%20document.querySelectorAll('h2')%3B%0A%0A%20%20%20%20headers.forEach(header%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20const%20dateStr%20%3D%20header.innerText.trim()%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20Skip%20headers%20that%20aren't%20dates%20(like%20%22Activity%22)%0A%20%20%20%20%20%20%20%20if%20(!%2FToday%7CYesterday%7C%5Cd%2F.test(dateStr))%20return%3B%0A%0A%20%20%20%20%20%20%20%20const%20formattedDate%20%3D%20formatDate(dateStr)%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20Step%202%3A%20Look%20at%20all%20sibling%20elements%20until%20the%20next%20Header%0A%20%20%20%20%20%20%20%20let%20sibling%20%3D%20header.nextElementSibling%3B%0A%20%20%20%20%20%20%20%20while%20(sibling%20%26%26%20sibling.tagName%20!%3D%3D%20'H2')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Step%203%3A%20Find%20Amount%20fields%20within%20this%20section%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20We%20use%20the%20'data-fs-privacy-rule%3D%22unmask%22'%20attribute%20which%20WS%20uses%20for%20sensitive%20data%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20amounts%20%3D%20sibling.querySelectorAll('p%5Bdata-fs-privacy-rule%3D%22unmask%22%5D')%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20amounts.forEach(pAmount%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20text%20%3D%20pAmount.innerText%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Check%20if%20this%20paragraph%20actually%20looks%20like%20an%20amount%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(text.includes('%24')%20%7C%7C%20text.includes('CAD'))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Step%204%3A%20Find%20the%20container%20row%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Traverse%20up%20parent%20elements%20until%20we%20find%20a%20container%20that%20holds%20both%20Payee%20and%20Amount%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20row%20%3D%20pAmount.parentElement%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20attempts%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(row%20%26%26%20row.parentElement%20!%3D%3D%20sibling%20%26%26%20attempts%20%3C%205)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20A%20valid%20row%20usually%20has%20at%20least%202%20unmasked%20fields%20(Payee%20and%20Amount)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(row.querySelectorAll('p%5Bdata-fs-privacy-rule%3D%22unmask%22%5D').length%20%3E%3D%202)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20row%20%3D%20row.parentElement%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20attempts%2B%2B%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(row)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Step%205%3A%20Check%20for%20%22Pending%22%20status%20and%20skip%20if%20found%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(row.innerText.includes(%22Pending%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Step%206%3A%20Extract%20Payee%20and%20Amount%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20allUnmasked%20%3D%20row.querySelectorAll('p%5Bdata-fs-privacy-rule%3D%22unmask%22%5D')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(allUnmasked.length%20%3E%3D%202)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20The%20first%20unmasked%20element%20is%20invariably%20the%20Payee%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20payeeRaw%20%3D%20allUnmasked%5B0%5D.innerText%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Escape%20quotes%20in%20payee%20name%20for%20valid%20CSV%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20payeeEscaped%20%3D%20%60%22%24%7BpayeeRaw.replace(%2F%22%2Fg%2C%20'%22%22')%7D%22%60%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20amountClean%20%3D%20cleanAmount(text)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Create%20a%20unique%20ID%20to%20avoid%20adding%20the%20same%20transaction%20twice%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20(e.g.%20if%20the%20DOM%20structure%20causes%20us%20to%20find%20the%20same%20row%20multiple%20times)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20uniqueId%20%3D%20formattedDate%20%2B%20payeeRaw%20%2B%20amountClean%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(!seen.has(uniqueId))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20seen.add(uniqueId)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rows.push(%5BformattedDate%2C%20payeeEscaped%2C%20amountClean%5D.join(%22%2C%22))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20sibling%20%3D%20sibling.nextElementSibling%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%2F%2F%20Final%20Step%3A%20Export%20or%20Alert%0A%20%20%20%20if%20(rows.length%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20alert(%22No%20completed%20transactions%20found.%5Cn%5CnTip%3A%20Scroll%20down%20to%20load%20more%20transactions%20before%20clicking.%22)%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20const%20csvContent%20%3D%20%22Date%2CPayee%2CAmount%5Cn%22%20%2B%20rows.join(%22%5Cn%22)%3B%0A%20%20%20%20%20%20%20%20const%20blob%20%3D%20new%20Blob(%5BcsvContent%5D%2C%20%7B%20type%3A%20%22text%2Fcsv%3Bcharset%3Dutf-8%3B%22%20%7D)%3B%0A%20%20%20%20%20%20%20%20const%20url%20%3D%20URL.createObjectURL(blob)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20const%20link%20%3D%20document.createElement(%22a%22)%3B%0A%20%20%20%20%20%20%20%20link.href%20%3D%20url%3B%0A%20%20%20%20%20%20%20%20link.download%20%3D%20%22wealthsimple_activity.csv%22%3B%0A%20%20%20%20%20%20%20%20document.body.appendChild(link)%3B%0A%20%20%20%20%20%20%20%20link.click()%3B%0A%20%20%20%20%20%20%20%20document.body.removeChild(link)%3B%0A%20%20%20%20%7D%0A%7D)()%3B%7D)()%3B